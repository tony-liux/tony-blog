---
title: 二项检验
author: ''
date: '2022-03-19'
categories:
  - nonparametric statistics
tags:
  - binomial test
subtitle: ''
lastmod: '2022-03-19T19:09:13+08:00'
authorLink: ''
description: ''
hiddenFromHomePage: no
hiddenFromSearch: no
featuredImage: ''
featuredImagePreview: ''
toc:
  enable: yes
  auto: no
math:
  enable: yes
lightgallery: yes
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>

<div id="TOC">

</div>

<p>在这一节中, 将考虑作为非参统计中入门课的二项检验.
二项检验是利用多次重复伯努利试验所得数据对总体成功概率 p 进行统计推断.
在非参数统计中, 由二项检验可以直接导出符号检验和分位数检验.</p>
<!--more-->
<div id="假设" class="section level2">
<h2>1 假设</h2>
<ol style="list-style-type: decimal">
<li>有一组 n 次重复伯努利试验数据(独立同分布于), 其中成功次数记为 x</li>
<li><span class="math inline">\(x\sim B(n,p)\)</span></li>
</ol>
</div>
<div id="临界值" class="section level2">
<h2>2 临界值</h2>
<p>规定 <span class="math inline">\(B_{\alpha/2}(n,p)\)</span> 为满足
<span class="math display">\[
\sum _ { i = 0 } ^ { c _ { 1 } }\binom{n}{i} p _ { 0 } ^ { i } ( 1 - p _ { 0 } ) ^ { n - i } \leq \frac { \alpha } { 2 }
\]</span>
的最大整数<span class="math inline">\(c_1\)</span>;</p>
<p>同理, 规定 <span class="math inline">\(B_{1-\alpha/2}(n,p)\)</span> 为满足
<span class="math display">\[
\sum _ { i = c_2 } ^ { n }\binom{n}{i} p _ { 0 } ^ { i } ( 1 - p _ { 0 } ) ^ { n - i } \leq \frac { \alpha } { 2 }
\]</span>
的最小整数</p>
</div>
<div id="双边检验" class="section level2">
<h2>3 双边检验</h2>
<div id="检验假设" class="section level3">
<h3>3.1 检验假设</h3>
<p><span class="math display">\[
H_0:p=p_0\longleftrightarrow H_1:p\neq p_0
\]</span>
### 3.2 检验统计量</p>
<p>原假设下,以 <span class="math inline">\(x\sim B(n,p_0)\)</span> 作为检验统计量</p>
</div>
<div id="拒绝域" class="section level3">
<h3>3.3 拒绝域</h3>
<p>对于给定的<span class="math inline">\(\alpha\)</span>,拒绝域为:</p>
<p><span class="math display">\[
W=\{x\leq B_{\alpha/2}(n,p_0)\}\cup\{x\geq B_{1-\alpha/2}(n,p_0)\}
\]</span></p>
</div>
<div id="p-值" class="section level3">
<h3>3.4 p 值</h3>
<p><span class="math inline">\(x_0\)</span>为统计量<span class="math inline">\(x\)</span>的一个观测值,</p>
<p><span class="math display">\[
2\min\{P(x\leq x_0),P(x\geq x_0)\}
\]</span></p>
</div>
</div>
<div id="左边检验" class="section level2">
<h2>4 左边检验</h2>
<div id="检验假设-1" class="section level3">
<h3>4.1 检验假设</h3>
<p><span class="math display">\[
H_0:p=p_0\longleftrightarrow H_1:p\leq p_0
\]</span>
### 4.2 检验统计量</p>
<p>原假设下,以 <span class="math inline">\(x\sim B(n,p_0)\)</span> 作为检验统计量</p>
</div>
<div id="拒绝域-1" class="section level3">
<h3>4.3 拒绝域</h3>
<p>对于给定的<span class="math inline">\(\alpha\)</span>,拒绝域为:</p>
<p><span class="math display">\[
W=\{x\leq B_{\alpha}(n,p_0)\}
\]</span></p>
</div>
<div id="p-值-1" class="section level3">
<h3>4.4 p 值</h3>
<p><span class="math inline">\(x_0\)</span>为统计量<span class="math inline">\(x\)</span>的一个观测值,</p>
<p><span class="math display">\[
P(x\leq x_0)
\]</span></p>
</div>
</div>
<div id="右边检验" class="section level2">
<h2>5 右边检验</h2>
<div id="检验假设-2" class="section level3">
<h3>5.1 检验假设</h3>
<p><span class="math display">\[
H_0:p=p_0\longleftrightarrow H_1:p\geq p_0
\]</span>
### 5.2 检验统计量</p>
<p>原假设下,以 <span class="math inline">\(x\sim B(n,p_0)\)</span> 作为检验统计量</p>
</div>
<div id="拒绝域-2" class="section level3">
<h3>5.3 拒绝域</h3>
<p>对于给定的<span class="math inline">\(\alpha\)</span>,拒绝域为:</p>
<p><span class="math display">\[
W=x\geq B_{1-\alpha}(n,p_0)
\]</span></p>
</div>
<div id="p-值-2" class="section level3">
<h3>5.4 p 值</h3>
<p><span class="math inline">\(x_0\)</span>为统计量<span class="math inline">\(x\)</span>的一个观测值,</p>
<p><span class="math display">\[
P(x\geq x_0)
\]</span>
## 6 大样本近似</p>
</div>
<div id="近似方法" class="section level3">
<h3>6.1 近似方法</h3>
<p>由于计算上的复杂性, 在样本量较大时, 考虑对上述检验临界值的计算使用正态分布近似.
具体而言, 根据中心极限定理, 对于充分大的 n, 有:</p>
<p><span class="math display">\[
x\stackrel{.}{\sim}N(Ex,Dx)=N(np,np(1-p))
\]</span>
据此构造统计量:
<span class="math display">\[
u=\frac{x-Ex}{\sqrt{D(x)}}=\frac{x-np}{\sqrt{np(1-p)}}\stackrel{.}{\sim}N(Ex,Dx)
\]</span>
便有检验拒绝域:</p>
<p><span class="math display">\[
\left. \begin{array}  { l  }  { W = \{ u \leq u _ { \alpha \} } } \\ { W = \{ u \geq u _ { 1-\alpha } \} } \\ { W = \{ | u | \geq u _ { 1 - \alpha / 2 } \} } \end{array} \right.
\]</span>
同时有检验 p 值:</p>
<p><span class="math inline">\(u_0\)</span>是统计量的观测值,</p>
<p><span class="math display">\[
p=P(u\leq u_0)
\]</span>
<span class="math display">\[
p=P(u\geq u_0)
\]</span></p>
<p><span class="math display">\[
p=2\min\{P(u\geq u_0),P(u\leq u_0)\}=2P(u\geq u_0)=2P(u\leq u_0)
\]</span>
### 6.2 近似程度评估</p>
<p>在这部分, 会根据给定的 n 绘制一个热图,
横坐标为成功概率 p, 纵坐标为显著性水平 <span class="math inline">\(\alpha\)</span>,
而热图的颜色则表示二项分布与正态分布的分位数差值 <span class="math inline">\(\alpha\)</span>, 定义为:
<span class="math display">\[
diff={\frac{B_\alpha(n,p)-np}{\sqrt{np(1-p)}}-N_\alpha(0,1)}
\]</span>
差值刻画了近似的准确性, 越接近于 0, 说明越正态分布近似得越好</p>
<div id="准备工作" class="section level4">
<h4>6.2.1 准备工作</h4>
<p>编写一个绘制热力图的函数, 便于查看结果.</p>
<p>这个函数会把数据矩阵以热力图形式展示.</p>
<pre class="r"><code>plot_mat &lt;- function(mat) {
  library(ggplot2)

  dat &lt;- reshape2::melt(mat)

  colnames(dat) &lt;- c(&quot;p&quot;, &quot;alpha&quot;, &quot;value&quot;)
  .color &lt;- c(
    RColorBrewer::brewer.pal(9, &quot;OrRd&quot;)[5:3],
    &quot;#f8f8ff&quot;, RColorBrewer::brewer.pal(9, &quot;Greens&quot;)[3:5]
  )

  dat %&gt;%
    ggplot(aes(x = p, y = alpha, fill = value)) +
    geom_tile(colour = &quot;white&quot;) +
    coord_equal() +
    scale_x_continuous(expand = c(0, 0)) +
    scale_y_continuous(expand = c(0, 0)) +
    scale_fill_gradientn(
      colors = .color,
      na.value = NA
    ) +
    theme_minimal() +
    theme(axis.ticks = element_line(size = 0.4))
}</code></pre>
</div>
<div id="比较结果" class="section level4">
<h4>6.2.2比较结果</h4>
<p>编写一个绘制函数</p>
<pre class="r"><code>plot_diff &lt;- function(n) {
  epsilon &lt;- 1e-2
  ps &lt;- seq(epsilon, 1 - epsilon, epsilon)
  alphas &lt;- seq(epsilon, 1 - epsilon, epsilon)

  theta &lt;- outer(ps, alphas, function(p, .alpha) {
    Ex &lt;- n * p
    Dx &lt;- n * p * (1 - p)
    (qbinom(.alpha, n, p) - Ex) / sqrt(Dx) - qnorm(.alpha)
  })
  rownames(theta) &lt;- ps
  colnames(theta) &lt;- alphas
  plot_mat(theta) + labs(title = paste0(&quot;n = &quot;, n))
}
plot_diff(10)</code></pre>
<p><img src="/posts/nonparametric-statistics/2022-03-19-binomial-test/index.zh-cn_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>p1 &lt;- plot_diff(10)
p2 &lt;- plot_diff(50)
p3 &lt;- plot_diff(100)
p4 &lt;- plot_diff(1000)

cowplot::plot_grid(p1, p2, p3, p4, nrow = 2, ncol = 2)</code></pre>
<p><img src="/posts/nonparametric-statistics/2022-03-19-binomial-test/index.zh-cn_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>从上面的结果看到, 随着样本量 n 的增大, 正态近似结果愈发接近于真实情况.</p>
</div>
</div>
</div>
